<div id="mainDiv" class="container-fluid mainFont" style="min-height: 100vh">
  <!-- Editor sor: -->
  <div class="row my-4">
    <div class="col-lg-12 d-flex justify-content-lg-end justify-content-center">
      @if (searchedUser?.id == userService.loggedUser()?.id || (searchedSchool?.id == userService.loggedUser()?.schoolId && userService.loggedUser()?.role?.name == "ROLE_school_owner")) {
        <button (click)="showDeleteConfirmation = true" class="editorButton mx-2">
          <i class="material-icons">delete</i>
        </button>
      }
      @if(type() == "school") {
        <button class="editorButton mx-2" (click)="showPriceList = true">
          <i class="material-icons">info</i>
        </button>
      }
      @if (searchedUser?.id == userService.loggedUser()?.id || searchedSchool?.id == userService.loggedUser()?.schoolId) {
        <button (click)="showEditor = true" class="editorButton mx-2">
          <i class="material-icons">edit</i>
        </button>
      }
    </div>
  </div>

  <div class="row h-100 mb-5">
    @if (errorMsg == "") {
      <div class="col-lg-4 d-flex justify-content-center align-items-center">
        <div class="container-fluid">
          @if (roleName == "Iskola" || roleName == "Oktató") {
            <div class="row">
              <div class="col-lg-12 d-flex justify-content-center align-items-center">
                <button class="text-white eventButton" (click)="showReviews = true">Review</button>
              </div>
            </div>
          }
          <div class="row">
            <div id="avatarDiv" class="col d-flex justify-content-center align-items-center">
              <img [src]="searchedUser?.pfpPath" id="avatar" class="img-fluid m-3" [class.userPfp]="type() == 'user'" [class.bannerImg]="type() == 'school'"/>

              <div id="editDiv" class="col-lg-12 d-flex justify-content-center align-items-center">
                @if (searchedUser?.id == userService.loggedUser()?.id || searchedSchool?.id == userService.loggedUser()?.schoolId) {
                  <input #fileInput type="file" name="fileInput" id="fileInput" style="display: none" (change)="changeImages($event)"/>
                  <button class="p-0" style="width: 60px">
                    <label for="fileInput" class="container-fluid d-flex justify-content-center align-items-center m-0 p-0">
                      <i class="material-icons">brush</i>
                    </label>
                  </button>
                }
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-lg-12 d-flex flex-column justify-content-center align-items-center">
              <button class="infoButton mb-2 eventButton text-white">
                <span class="material-icons">mail</span>
              </button>
              @if ((type() == "school" &&(userService.loggedUser()?.role?.name == "ROLE_user" ||userService.loggedUser()?.role?.name == "ROLE_instructor") ||type() == "user" && userService.loggedUser()?.role?.name == "ROLE_student" && userService.loggedUser()?.instructor == null)){
                <button id="signButton" (click)="sendJoinRequest()" [disabled]="type() == 'school' && selectedCategory == null && userService.loggedUser()?.role?.name == 'ROLE_user'">Jelentkezés</button>
                @if (userService.loggedUser()?.role?.name == "ROLE_user") {
                  <select #categorySelect (change)="selectedCategory = +categorySelect.value">
                    @for (category of searchedSchool?.licenseCategoryList; track $index) {
                      <option [value]="category.licenseCategory.id">{{category.licenseCategory.name}}</option>
                    }
                  </select>
                }
            }
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-8">
        <div class="container-fluid">
          <div class="row">
            <div class="col-lg-12">
              <div class="container-fluid my-lg-0 my-5" id="infoBox">
                <div class="row">
                  <div class="col-lg-12">
                    <h1 style="color: #dee0eb">
                      {{searchedUser == null ? searchedSchool!.name : searchedUser.firstName + " " + searchedUser.lastName}}
                    </h1>
                    <h4 style="color: #b3b8d1">{{ roleName }}</h4>
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg-12">
                    <div class="uData mt-0 px-3">
                      <span class="fw-bold">{{searchedUser == null ? "Cím:" : "Születési Dátum:"}}</span>
                      <span>{{searchedUser == null ? searchedSchool?.country + " " + searchedSchool?.town + " " + searchedSchool?.address: (searchedUser.birthDate | date)}}</span>
                    </div>
                    <div class="uData mt-0 px-3">
                      <span class="fw-bold">{{ searchedUser == null ? "Tulaj:" : "Nem:" }}</span>
                      <span>{{ searchedUser == null ? searchedSchool?.owner?.firstName + " " + searchedSchool?.owner?.lastName : searchedUser.gender}}</span>
                    </div>
                    <div class="uData mt-0 px-3">
                      <span class="fw-bold">E-mail:</span>
                      <span>{{ searchedUser == null ? searchedSchool!.email : searchedUser.email }}</span>
                    </div>
                    <div class="uData mt-0 px-3">
                      <span class="fw-bold">Telefonszám: </span>
                      <span>{{ searchedUser == null ? searchedSchool!.phone : searchedUser.phone }}</span>
                    </div>
                    @if (type() == "user" &&searchedUser?.role?.name == "ROLE_instructor") {
                      <div class="uData mt-0 px-3">
                        <span class="fw-bold">Iskola: </span>
                        <span>{{ searchedUser?.instructor?.instructorSchool?.name}}</span>
                      </div>
                    }
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg-12">
                    @if (type() == "user") {
                      @if (searchedUser?.role?.name == "ROLE_instructor") {
                        <div class="container-fluid">
                          <div class="row">
                            <div class="col-lg-6">
                              <div class="instructorInfoBox">
                                <p>{{ instructorDetails?.promoText }}</p>
                              </div>
                            </div>
                            <div class="col-lg-6">
                              <div class="instructorInfoBox">
                                <img class="img-fluid" src="assets/icons/kijeletkezés.svg" alt=""/>
                                <p class="w-100 text-white info-field d-flex align-items-center justify-content-between">
                                  <span>Név:</span>
                                  <span>{{instructorDetails?.vehicle?.name}}</span>
                                </p>
                                <p class="w-100 text-white info-field d-flex align-items-center justify-content-between">
                                  <span>Típus:</span>
                                  <span>{{instructorDetails?.vehicle?.vehicleType?.name}}</span>
                                </p>
                                <p class="w-100 text-white info-field d-flex align-items-center justify-content-between">
                                  <span>Rendszám:</span>
                                  <span>{{instructorDetails?.vehicle?.licensePlate}}</span>
                                </p>
                              </div>
                            </div>
                          </div>
                        </div>
                      } @else if (searchedUser?.role?.name == "ROLE_student") {
                        <!-- <div class="w-100 d-flex justify-content-center"> -->
                        <div class="w-100">
                          <div id="progressBar" class="w-100 p-4">
                            <input id="bar" type="range" min="0" max="30" value="9" disabled/>
                            <div class="d-flex flex-md-row flex-column justify-content-lg-start justify-content-center align-items-center">
                              <div class="lesson-info-item lesson-info-driven me-4">
                                Vezetett órák: <span>9</span>
                              </div>
                              <div class="lesson-info-item lesson-info-extra">
                                Plusz órák: <span>0</span>
                              </div>
                              <div class="mx-3 lesson-info-item lesson-info-required d-lg-none d-block">
                              Kötelező órák: <span>21</span>
                            </div>
                            </div>
                            <div class="lesson-info-item lesson-info-required d-lg-block d-none">
                              Kötelező órák: <span>21</span>
                            </div>
                          </div>
                        </div>
                      }
                    } @else if (type() == "school") {
                      <div class="container-fluid">
                        <div class="row">
                          <div class="col-lg-4 my-lg-0 my-4">
                            <div id="openingDetails" class="p-3">
                              <div class="row">
                                <div class="col-lg-12">
                                  <h2 class="text-center text-white">Nyitvatartás</h2>
                                </div>
                              </div>

                              <div class="row">
                                <div class="col-lg-12">
                                  @for (item of searchedSchool?.openingDetails;track $index) {
                                    <p
                                      class="d-flex justify-content-between text-white"
                                    >
                                      <span>{{ item.day }}:</span>
                                      <span>
                                        @if (!item.isClosed) {
                                          {{ item.openingTime }} -
                                          {{ item.closeTime }}
                                        } @else {
                                          Zárva
                                        }
                                      </span>
                                    </p>
                                  }
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="col-lg-8 ">
                            <div id="instructorList" class="container-fluid">
                              <div class="row my-3">
                                <div class="col-lg-12">
                                  <h2 class="text-center text-white">Oktatóink:</h2>
                                </div>
                              </div>

                              @for (row of getInstructorRows(); track $index) {
                                <div class="row">
                                  @for (instructors of row; track $index) {
                                    <div class="col-lg-6">
                                      <app-profil-card [profilCardData]="instructors" [role]="'instructors'"/>
                                    </div>
                                  }
                                </div>
                              }
                            </div>
                          </div>
                        </div>
                      </div>
                    }
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    } @else if (errorMsg == "notFound") {
      <h1>Nincs ilyen {{ type() == "user" ? "Felhasználó" : "Iskola" }}</h1>
    } @else if (errorMsg == "serverError") {
      <h1>Hiba történt! Kérlek próbáld újra</h1>
    }
  </div>
</div>

@if (showEditor) {
  <app-profil-editor (close)="showEditor = false" [objectType]="searchedSchool == null ? 'user' : 'school'" [wantedObject]="searchedSchool == null ? searchedUser! : searchedSchool"/>
}
@if (showReviews) {
  <app-review-list (closeList)="showReviews = false" [reviewType]="roleName" [aboutObject]="searchedUser == null ? searchedSchool! : instructorDetails!"/>
}

@if (showDeleteConfirmation) {
  <div class="container-fluid" id="deleteContainer">
    <div class="row h-100">
      <div class="col-lg-12 h-100 d-flex justify-content-center align-items-center">
        <div id="profDel">
          <div class="h-100 d-flex flex-column justify-content-between">
            <h3 class="text-center text-white">Biztosan törölni szeretnéd?</h3>
            <div class="w-100 d-flex justify-content-center align-items-center mb-3">
              <button class="text-white eventButton" (click)="deleteProfile()">Igen</button>
              <button class="text-white eventButton" (click)="showDeleteConfirmation = false">
                Nem
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
}
@if (showPriceList) {
  <app-price-list [schoolId]="searchedSchool?.id!" (close)="showPriceList = false"/>
}
